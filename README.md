# Chiral Client in Java

## Add chiral-client in your project 

### Maven

1. add a repository in ```pom.xml```
```xml
<repositories>
    <repository>
        <id>clientlib</id>
        <url>https://maven.fury.io/chiral/</url>
    </repository>
</repositories>
```

2. add the dependency ```clientlib``` 
```xml
  <dependencies>
    <dependency>
      <groupId>com.chiral.client</groupId>
      <artifactId>clientlib</artifactId>
      <version>0.1.0</version>
    </dependency>
  </dependencies>
```

## Initialize a Client object

The client is constructed through the ```com.chiral.client.Client``` class constructor, as follows.

```java
Client(serverAddr, serverPort, serverAddr, ftpPort, userId, apiToken)

```

## Use Gromacs through Chiral Services

### File storage for users

Software like gromacs requires input files and generates output files during simulations. Chiral provides a storage space to each registered user for file transfering.

Input files will be uploaded from user side to chiral cloud, meanwhile output files will be available for being downloaded by the users.

### Gromacs APIs
```java
public JobManager(String simulationId, String localDirectory)
// Construct a JobManager for Gromacs
// Parameters:
//      - simulationId: user-defined simulation id, all related files of the simulation with this ID will be saved under "gromacs/simulationId" in the file storage space in cloud. 
//      - localDirectory: all related files of the simulation will be saved under this directory locally.

public void uploadFiles(Client client, String[] files) throws IOException {}
// Upload Files
//      - client: an initialized com.chiral.client.Client
//      - files: files to be uploaded

public void downloadFiles(Client client, String[] files) throws IOException {}
// Download Files
//      - client: an initialized com.chiral.client.Client
//      - files: files to be downloaded 

public void clearFiles(Client client) throws IOException {}
// Clear all the contents under gromacs/simulationId and then rmove the empty directory "gromacs/simulationId"
//      - client: an initialized com.chiral.client.Client

public String submitJob(Client client, String subCommand, String arguments, String prompts, String[] filesInput, String[] filesOutput) throws JsonProcessingException {}
//  Submit a gromacs job
//      - client: an initialized com.chiral.client.Client
//      - subCommand: gromacs subcommand such as "mdrun", "grompp", etc.
//      - arguments: command arguments
//      - prompts: user inputs after the command starts.
//      - filesInput: files required as input for the command.  
//      - filesOutput: files generated by the command and saved in the storage space. files not listed will be discarded. 
//  returns a String as the Job ID.

public void waitUntilCompletion(Client client, String jobId) throws JsonProcessingException, InterruptedException {}
// Check the job status every 500 milliseconds until the job is completed
//      - client: an initialized com.chiral.client.Client
//      - jobId: the Job ID returned after the job submital.

public Output getOutput(Client client, String jobId) throws JsonProcessingException {}
// Class Output has three variables
//      - success: true if the job is successfully completed, otherwise false.
//      - stdout: the standard output of the command from the job.
//      - stderr: the error output of the command from the job.
//  This method can be used to get more information about the gromacs command execution. For example, if the job is not successfully completed, users can retrieve useful information from Output.stderr to identify the root cause of failure. 
```

### Examples
- The ```testGromacs``` from ```AppTest.java``` is a simulation example by gromacs for lysozyme.
- All the inputs files required by this examples can be found from ```files/lysozyme```.
